# Achievement Master — Claude Code 用インプット設計書（Godot 4.5.1 / プロトタイプ）
> 目的：Claude Code に「Achievement Master」のプロトタイプ開発を自律的に進めさせるための、初回投入用の指示（仕様＋実装方針）をまとめたもの。  
> **可読性と実装可能性を優先**。不明点は「仮仕様」として明記し、後で差し替えやすくする。

---

## 0. 実行環境・前提
- ゲームエンジン：**Godot 4.5.1**
- プラットフォーム：PC（キーボード/マウス）を優先。※後でモバイル拡張
- 2D：Top-down（見下ろし）アクションRPG
- 言語：GDScript
- 単体テスト：**GUT** を導入（`res://test/unit/` 配下に `test_*.gd`）
- Git：`main` を主軸。作業はブランチ切って実装→テスト→マージ
- コメント：**日本語で簡潔に**（主要メソッド・意図が伝わる程度）

---

## 1. プロトタイプのゴール（最重要）
### 1.1 成功条件（UX観点）
- **あらゆる行動で実績が解除**される体験が、テンポ良く気持ちいい
- 実績解除 → **AP獲得** → 報酬ツリー解放（強化/QoL） → 次の目標が自然に決まる
- 実績通知が「気持ちいい」が「邪魔にならない」
  - 戦闘中は通知を抑制（Bronzeまとめ表示 / Silver・Goldのみ個別）

### 1.2 プレイ可能な最小範囲
- **村（農業・会話・クエスト受注）**
- **小規模ダンジョン（雑魚 + 中ボス）**
- 実績：**50個**（ログ系25 / 目標系15 / チャレンジ系10）
- 報酬ツリー：グローバル/戦闘/農業クラフト/探索交流 の4カテゴリ（合計 ~25ノード）

---

## 2. コアコンセプトとゲームループ
### 2.1 コアループ
1) 行動（戦闘/農業/探索/交流）  
2) 実績解除  
3) AP（Achievement Point）獲得  
4) 報酬ツリー解放（強くなる・快適になる）  
5) より高難度実績に挑戦  
→ ①〜⑤をループ

### 2.2 リスクと対策（仕様に組み込む）
- 実績が多すぎて価値が薄れる  
  → 実績ランク（B/S/G）と解除頻度カーブ（序盤頻繁→中盤目的→終盤挑戦）
- 作業化・悪用（連打/放置）  
  → 実戦条件、同一NPC連打無効、多様性ボーナス（別カテゴリ連続でAPボーナス）
- 成長インフレ  
  → 縦成長だけでなく QoL/横成長を混ぜる（ミニマップ、ピン留め、回収補助など）

---

## 3. 画面・UX仕様（必須）
### 3.1 ゲーム画面（HUD / オーバーレイ）
#### 必須要素（推奨配置）
- 左上：HPバー / スタミナバー / 所持金（任意）
- 右上：ミニマップ（任意だが推奨）
- 右側：**ピン留め実績進捗（最大3件）**
- 左下：インタラクトプロンプト（例：E: 話す / 収穫）
- 右下：クイックスロット（回復/道具）
- 中央下：**実績解除トースト通知**（短く・自動で消える）

#### HUD状態
- NORMAL：通常表示
- COMBAT：Bronze通知はまとめ、Silver/Goldのみ個別
- DIALOG：戦闘系UIは薄く/非表示（仮）
- MENU：HUD非表示（ポーズメニュー優先）

### 3.2 メニュー画面（Pause / 4タブ）
- タブ：**装備 / ステータス / スキル / 実績**
- 共通構成：上部タブ、左リスト、右詳細、下部操作ガイド

#### 実績タブ（最重要）
- フィルタ：カテゴリ（戦闘/農業/探索/交流/システム）、未達成/達成済、ランク
- 詳細：条件、進捗、AP報酬、ヒント（任意）
- **ピン留め（追跡）**：HUDに進捗を表示
- おすすめ（後回し可）：達成が近い3件を提案（カテゴリ分散）

---

## 4. システム仕様（実装の核）
### 4.1 実績・AP・報酬ツリー
- AP（Achievement Point）：実績解除で獲得、報酬ツリー解放に使用
- 実績ランク：Bronze / Silver / Gold
  - B：AP 1〜2
  - S：AP 3〜4
  - G：AP 6〜10
- 報酬ツリー：ノードをAPで解放し、プレイヤーに永続効果を付与
- リスペック：プロトタイプでは **未実装でもOK**（後で追加）

### 4.2 データ駆動（強く推奨）
- 実績定義：JSON か Resource（`.tres`）で管理（**差し替えやすさ重視**）
- 報酬ツリー定義：同様にデータで管理
- セーブ：PlayerStats / UnlockedAchievements / EarnedAP / UnlockedRewards / PinnedAchievements を保存

### 4.3 進捗管理のルール（最低限）
- 同一NPC連打はカウントしない（同一会話を短時間で繰り返しても増えない）
- 実戦条件：戦闘カテゴリの一部は敵対状態でのみカウント
- 多様性ボーナス（任意）：別カテゴリ行動を連続するとAP+10%（最大+30%）

---

## 5. 実績リスト（50個）— プロトタイプ版（要実装）
> 実績はデータ定義で作ること。コードにベタ書きしない。

### 5.1 行動ログ系（25）
- 移動する / 攻撃する / 敵1体撃破 / 回復使用 / 採取 / クラフト / NPC会話 / クエスト受注 / 納品完了 / 収穫 …等
- 目標：序盤10分で **8〜12個**解除されるペース

### 5.2 目標系（15）
- 討伐クエスト3件 / 敵30体 / 宝箱5個 / 採取20回 / 収穫10回 / クラフト10回 / 会話20回 / クエスト10件 / 中ボス撃破 …等

### 5.3 チャレンジ系（10）
- ノーダメ連戦 / 回避連続 / パリィ成功 / 縛り装備で中ボス / 30秒討伐 / 回復禁止フロア突破 / 多カテゴリ同日達成 …等

※正確な一覧は別途 `achievements.json` に定義して作成すること（ここでは設計指針）。

---

## 6. 報酬ツリー（例）— プロトタイプ版
> こちらもデータ定義で作成。

### 6.1 グローバル（QoL）
- 通知フィルタ、ピン留め枠+1、おすすめ表示、多様性ボーナス、（任意）リスペック

### 6.2 戦闘
- HP+10%、攻撃+5%、回避無敵+、パリィ解放、スタミナ回復+、ポーション即時スロット、自動回収、敗北復帰短縮

### 6.3 農業/クラフト
- 種上限、じょうろ範囲、成長+、収穫ボーナス、料理、納品箱、アクション短縮、列植え

### 6.4 探索/交流
- 移動速度、ミニマップ、目的地ピン、ファストトラベル、宝箱レーダー、店割引、会話スキップ+要約

---

## 7. Godot 実装アーキテクチャ（推奨）
### 7.1 シーン（最小）
- `scenes/world/village.tscn`（村）
- `scenes/world/dungeon.tscn`（小ダンジョン）
- `scenes/ui/hud.tscn`（HUD）
- `scenes/ui/pause_menu.tscn`（メニュー：4タブ）
- `scenes/player/player.tscn`（プレイヤー）
- `scenes/enemies/slime.tscn`（雑魚例）
- `scenes/enemies/mid_boss.tscn`（中ボス）

※パスはプロジェクトに合わせて調整。Claude Code は **一貫した規則**で作ること。

### 7.2 Autoload（シングルトン）
- `GameState`：戦闘状態、ポーズ状態、現在シーン等
- `SaveManager`：セーブ/ロード（JSON推奨）
- `AchievementManager`：実績進捗、解除判定、通知イベント
- `RewardManager`：報酬ツリー解放と効果適用
- （任意）`AudioManager`

### 7.3 入力（InputMap）
- `move_up/down/left/right`
- `attack`
- `dash`
- `interact`
- `open_menu`
- `quickslot_1/2/3`

---

## 8. HUDワイヤーフレーム（Godot実装前提）
> HUDのノードは CanvasLayer + 安全域 MarginContainer を基本にする。

推奨ツリー（概要）：
- `CanvasLayer(HUD)`
  - `MarginContainer(RootSafeArea)`
    - `TopLeft/PlayerStatusPanel`：HP/スタミナ/所持金
    - `TopRight/MiniMap`：ミニマップ
    - `TopRight/PinnedAchievementPanel`：最大3件
    - `BottomLeft/InteractionPrompt`：インタラクト表示
    - `BottomRight/QuickSlotPanel`：道具スロット
    - `CenterOverlay/ToastContainer`：実績通知キュー

実績通知（Toast）の仕様：
- 表示時間：2秒（仮）
- 戦闘中：Bはまとめ、S/Gは即表示
- ログ：解除履歴は Achievement メニューで確認可能

---

## 9. セーブデータ仕様（プロトタイプ）
### 9.1 保存対象（最低限）
- Player：HP/最大HP、攻撃、防御、所持金、所持アイテム（簡易でOK）
- 実績：解除済みID、進捗値（カウンタ系）
- AP：所持AP、累計AP（任意）
- 報酬：解放済みノードID
- ピン留め：ピンID配列（最大3）

### 9.2 フォーマット
- JSON（`user://save.json`）推奨

---

## 10. テスト（GUT）— 最低限の対象
- `AchievementManager`
  - 進捗加算が正しい
  - 条件達成で解除される
  - 二重解除されない
  - ピン留めが最大数を超えない
- `RewardManager`
  - ノード解放で効果が反映される
  - AP消費が正しい

---

## 11. 開発タスク順（Claude Code はこの順で実装）
1) プロジェクト初期化（シーン/フォルダ/入力/Autoload）
2) Player 移動/攻撃/回避（最小）
3) 村・ダンジョンの最小ループ（出入り、敵1種）
4) `AchievementManager`（データ定義 + 解除イベント）
5) HUD（HP/スタミナ/プロンプト/トースト/ピン進捗）
6) PauseMenu（4タブ）— 実績タブ優先
7) `RewardManager`（報酬解放と効果適用）
8) セーブ/ロード
9) バランス調整（解除頻度・通知・APコスト）
10) GUTテスト追加/整備

---

## 12. 受け入れ条件（Definition of Done）
- 起動してすぐ村で行動できる
- ダンジョンに入って雑魚を倒せる
- 行動に応じて実績が解除され、APが増える
- メニュー実績タブで「未達成」「カテゴリ」「ピン留め」が使える
- ピン留め進捗がHUDに表示される
- 報酬ツリーで解放すると、プレイヤーが強くなる/快適になる
- セーブ→再起動→ロードで状態が復元される
- 実績解除通知が邪魔になりすぎない（戦闘中抑制が効く）

---

## 13. Claude Code への作業指示テンプレ（そのまま貼る用）
以下を Claude Code に貼り付けて作業開始させる：

- この設計書に従って Godot 4.5.1 でプロトタイプを実装すること
- まずフォルダ/シーン/Autoload/InputMap を構築し、次に Player の最小アクション、その後 AchievementManager とHUD、最後にメニューと報酬、セーブを実装すること
- 実績・報酬は **データ駆動**（JSON or Resource）で作ること
- 重要ロジックは GUT でユニットテストを用意すること
- 主要メソッドには日本語で短いコメントを入れること
- 進捗が分かるよう、コミット単位を小さくし、変更点を要約すること

---

## 付録：不足情報（仮置きして進めて良い）
- 正確なアート素材（プレースホルダーでOK）
- 敵/ボスの具体挙動（最小でOK）
- クエストの詳細（最小でOK）
- アイテム/装備の完全設計（プロトタイプでは簡易でOK）
