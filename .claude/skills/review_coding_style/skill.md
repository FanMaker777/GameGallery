---
name: review_coding_style
description: コーディング規約を読み込み、セッション中に変更した GDScript ファイルを規約準拠レビューし、必要に応じて修正する。
user_invocable: true
---

# review_coding_style スキル

セッション中に変更された GDScript ファイルをコーディング規約に照らしてレビューし、違反箇所を修正する。

**プロジェクトルート:** `D:/MyWork/GameDevelopment/Godot/Godot_v4.5.1/projects/GameGallery`（以下 `$ROOT`）

## 実行ステップ

### ステップ 1: コーディング規約の読み込み

`$ROOT/doc/guides/coding-style.md` を Read で読み込み、全ルールを把握する。

### ステップ 2: 変更ファイルの特定

以下の Bash コマンドで、セッション中に変更された `.gd` ファイルを特定する:

```bash
cd "$ROOT" && git diff --name-only HEAD -- '*.gd' && git diff --name-only --cached -- '*.gd' && git ls-files --others --exclude-standard -- '*.gd'
```

これにより以下を収集する:
- ステージ未追加の変更 `.gd` ファイル
- ステージ済みの変更 `.gd` ファイル
- 新規（未追跡）の `.gd` ファイル

変更ファイルがない場合は「レビュー対象のファイルがありません」と報告して終了する。

### ステップ 3: 各ファイルのレビュー

変更された `.gd` ファイルをすべて Read で読み込み、以下の観点でチェックする:

#### チェック項目

| # | カテゴリ | チェック内容 |
|---|----------|-------------|
| 1 | **命名** | 変数/関数が `snake_case`、定数が `UPPER_SNAKE_CASE`、クラス名が `PascalCase`、ファイル名が `snake_case.gd`、命名が全て英語 |
| 2 | **型注釈** | 変数・引数・戻り値に型注釈が付いているか |
| 3 | **コメント** | 全クラス・全関数・全変数・全処理ブロックに日本語コメントがあるか |
| 4 | **ログ** | `print()` を使わず `Log` オートロードを使用しているか。基本が `Log.debug()` で `Log.info()` は重要情報のみか |
| 5 | **品質** | ゲームパラメータが `@export` 変数か、フォールバック処理を使用していないか、Resource を活用しているか |
| 6 | **ノード参照** | `@onready var xxx: Type = %Name` の形式を使用しているか |

### ステップ 4: 違反の修正

違反が見つかった場合、Edit ツールで修正する。

**修正の原則:**
- 規約違反の箇所のみ修正する（ついでリファクタリングはしない）
- コメント追加時は既存コードのスタイルに合わせる
- 修正に迷う場合（命名変更でシグナル接続や外部参照に影響がある等）は修正せず報告のみ行う

### ステップ 5: レビュー結果の報告

日本語で以下の形式で報告する:

```
## コーディング規約レビュー結果

### レビュー対象
- `path/to/file1.gd`
- `path/to/file2.gd`

### 修正した違反
- `file1.gd` L42 — コメント追加（関数ヘッダが未記載）
- `file1.gd` L58 — `print()` → `Log.debug()` に変更
- ...

### 修正を見送った項目（要確認）
- `file2.gd` L15 — 変数名 `Pos` は PascalCase だが外部参照があるため手動確認が必要
- ...

### 違反なし
- `file3.gd` — 規約準拠
```

違反が一切なかった場合:

```
## コーディング規約レビュー結果

全ファイルが規約に準拠しています。修正は不要でした。
```
